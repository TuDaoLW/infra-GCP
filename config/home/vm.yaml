---
compute_instances:
  management-vm-01: #new format
    project_id: adroit-nimbus-481707-i0
    zone: asia-southeast1-b
    machine_type: e2-small
    description: "Management VM for administrative tasks and tooling"
    service_account: management-vm-sa
    disks:
      - device_name: boot-disk
        boot: true
        auto_delete: true
        initialize_params:
          image: "projects/ubuntu-os-cloud/global/images/family/ubuntu-2204-lts" # Full image selfLink
          size_gb: 24
          type: pd-balanced

      - device_name: data-disk-01
        boot: false
        auto_delete: false
        initialize_params:
          size_gb: 20
          type: pd-balanced

    network_interfaces: # Standardized to snake_case
      - subnetwork: "projects/adroit-nimbus-481707-i0/regions/asia-southeast1/subnetworks/management" # Full subnetwork selfLink recommended
        # Private IP Configuration:
        network_ip: "10.0.0.10"

        # Public IP Configuration:
        # access_configs:
        #   - type: ONE_TO_ONE_NAT
        # For an ephemeral public IP, omit nat_ip.
        # nat_ip: "projects/adroit-nimbus-481707-i0/regions/asia-southeast1/addresses/my-static-external-ip"

    metadata:
      enable-oslogin: "TRUE" # string
      startup-script: |
        #!/bin/bash
        echo "Running startup script for management-vm-01..."
        # Add your startup commands here, e.g., install software, configure services
        sudo apt-get update
        sudo apt-get install -y nginx
        echo "Hello from management-vm-01!" | sudo tee /var/www/html/index.html
        echo "Startup script finished."
      shutdown-script: |
        #!/bin/bash
        echo "Running shutdown script for management-vm-01..."
        # Add your shutdown commands here, e.g., graceful service shutdown, data sync
        echo "Shutdown script finished."

    tags: # Network tags for firewall rules and route targeting
      - "management-server"
      - "ssh-allowed"
      - "outbound-http"
      - "iap-ssh"

    extra_labels:
      application: "management-tools"
      service: "ssh-gateway"

    can_ip_forward: false # false unless acting as a NAT gateway or router
    deletion_protection: false
    confidential_instance_config: # only some specific machine types support this
      enable_confidential_compute: false
    shielded_instance_config: # Recommended for all production VMs
      enable_secure_boot: true
      enable_vtpm: true
      enable_integrity_monitoring: true
    # guest_accelerator: # Example: For GPU-attached VMs
    #   - type: "nvidia-tesla-v100"
    #     count: 1
